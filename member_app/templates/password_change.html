{% extends 'base.html' %}
{% load i18n %}
{% block title %}{% trans "Changer le mot de passe - Cinéma" %}{% endblock %}

{% block content %}
<div class="row justify-content-center mt-5">
    <div class="col-md-5">
        <div class="card shadow-lg">
            {% include 'snippets/card_header_snippet.html' with header_title=_('Changer le mot de passe') header_icon='fas fa-key' header_centered=True %}
            <div class="card-body p-4">
                
                <!-- Messages de succès -->
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                            <i class="fas fa-check-circle me-2"></i>{{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endfor %}
                {% endif %}

                <form method="post">
                    {% csrf_token %}
                    
                    <!-- Messages d'erreur généraux -->
                    {% include 'snippets/alert_snippet.html' with errors=form.non_field_errors alert_title=_('Erreurs de validation') %}
                    
                    <!-- Ancien mot de passe -->
                    <div class="mb-3">
                        <label for="{{ form.old_password.id_for_label }}" class="form-label">
                            <i class="fas fa-lock me-1"></i>{{ form.old_password.label }}
                        </label>
                        {{ form.old_password }}
                        {% if form.old_password.errors %}
                            <div class="text-danger mt-1">
                                {% for error in form.old_password.errors %}
                                    <small><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</small>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <!-- Nouveau mot de passe -->
                    <div class="mb-3">
                        <label for="{{ form.new_password1.id_for_label }}" class="form-label">
                            <i class="fas fa-key me-1"></i>{{ form.new_password1.label }}
                        </label>
                        {{ form.new_password1 }}
                        {% if form.new_password1.errors %}
                            <div class="text-danger mt-1">
                                {% for error in form.new_password1.errors %}
                                    <small><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</small>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <!-- Confirmation du nouveau mot de passe -->
                    <div class="mb-3">
                        <label for="{{ form.new_password2.id_for_label }}" class="form-label">
                            <i class="fas fa-key me-1"></i>{{ form.new_password2.label }}
                        </label>
                        {{ form.new_password2 }}
                        {% if form.new_password2.errors %}
                            <div class="text-danger mt-1">
                                {% for error in form.new_password2.errors %}
                                    <small><i class="fas fa-exclamation-circle me-1"></i>{{ error }}</small>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    {% include 'snippets/button_snippet.html' with button_text=_('Changer le mot de passe') button_icon='fas fa-key' button_style='warning' extra_classes='w-100 mb-3' %}
                </form>
                
                <hr class="my-3">
                
                <div class="text-center">
                    {% include 'snippets/button_snippet.html' with button_type='link' button_url='profile_edit' button_text=_('Retour au profil') button_icon='fas fa-user-edit' button_style='outline-primary' extra_classes='mb-2' %}
                    {% include 'snippets/button_snippet.html' with button_type='link' button_url='index' button_text=_("Retour à l'accueil") button_icon='fas fa-home' button_style='outline-secondary' %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}